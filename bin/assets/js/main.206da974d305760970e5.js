!function(){"use strict";function p(){localStorage.setItem("indexSettings",JSON.stringify(s))}function o(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}function v(){var e=document.querySelectorAll(".zoom-in"),t=document.querySelectorAll(".zoom-out"),n=document.querySelectorAll(".toggle-settings");e.forEach(function(e){e.dataset.attached||(e.dataset.attached="true",e.addEventListener("click",function(){var e=(m.zoomLevel+.1).toFixed(1);b("zoomLevel",Math.max(.1,Number(e))),k()}))}),t.forEach(function(e){e.dataset.attached||(e.dataset.attached="true",e.addEventListener("click",function(){var e=(m.zoomLevel-.1).toFixed(1);b("zoomLevel",Math.min(2,Number(e))),k()}))}),n.forEach(function(e){e.dataset.attached||(e.dataset.attached="true",e.addEventListener("click",function(){return z()}))})}function a(e){if(!w.current){w.current=!0;try{var t;l=e,u.find(function(e){return e.isViewing}).isViewing=!1,u[l-1].isViewing=!0,m.mode===n.Normal&&(d.href="/archive/".concat(c,"/").concat(i,"/").concat(l),(t=document.createElement("img")).src="".concat(g,"/data/").concat(c,"/").concat(l,".jpg"),E.replaceWith(t),E=t),h.forEach(function(e){return e.textContent=l.toString()}),window.history.replaceState(null,"","/archive/".concat(c,"/").concat(i,"/").concat(l)),L.forEach(function(e){return e.href="/archive/".concat(c,"/").concat(i,"/").concat(l-1)}),y.forEach(function(e){return e.href="/archive/".concat(c,"/").concat(i,"/").concat(l+1)})}finally{w.current=!1}}}function f(){for(var t=u.findIndex(function(e){return e.isViewing}),a=0,e=function(e){var n=u[e];if(n.isPreloading||n.isPreloaded||e<Math.max(0,t-S)||e>Math.min(u.length,t+S))return"continue";var o=e+1;n.isPreloading=!0,setTimeout(function(){function e(){n.isPreloading=!1,n.isPreloaded=!0}var t=document.createElement("img");t.src="".concat(g,"/data/").concat(c,"/").concat(o,".jpg");t.complete?e():(t.addEventListener("load",e),t.addEventListener("error",function(){return n.isPreloading=!1}))},1e3*a),a++},n=0;n<u.length;n++)e(n)}function e(){"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(e){for(var t=0;t<e.length;t++)e[t].unregister()}),(n=document.querySelector(".toggle-filter"))&&(x(),A(),n.addEventListener("click",function(){return q()}));var e,t,n=document.getElementById("reader");n&&(c=document.body.dataset.id,i=document.body.dataset.slug,r=Number(document.body.dataset.totalPages),h=document.querySelectorAll(".current"),l=Number(h[0].textContent),u.push.apply(u,Array.from({length:r},function(e,t){return{isViewing:t+1===l}})),d=n.querySelector(".page a"),E=d.querySelector("img"),g=new URL(E.src).origin,document.querySelectorAll(".first").forEach(function(e){e.addEventListener("click",function(e){o(e),1<l&&a(1)})}),document.querySelectorAll(".last").forEach(function(e){e.addEventListener("click",function(e){o(e),l<r&&a(r)})}),(L=document.querySelectorAll(".prev")).forEach(function(e){e.addEventListener("click",function(e){o(e),1<l&&a(l-1)})}),(y=document.querySelectorAll(".next")).forEach(function(e){e.addEventListener("click",function(e){o(e),l<r&&a(l+1)})}),d.addEventListener("click",function(e){o(e);var t=e.target,e=e.offsetX<=t.clientWidth*m.zoomLevel/2;e&&1<l?a(l-1):!e&&l<r&&a(l+1)}),e=0,t=function(){clearInterval(e),e=window.setInterval(function(){window.requestAnimationFrame(function(){E.naturalHeight&&(clearInterval(e),d.scrollIntoView({block:"start",inline:"start"}))})},10)},new MutationObserver(function(){t(),f()}).observe(d,{childList:!0}),window.addEventListener("keydown",function(e){1<l&&("ArrowLeft"===e.code||"KeyA"===e.code||"KeyH"===e.code)?a(l-1):l<r&&("ArrowRight"===e.code||"KeyD"===e.code||"KeyL"===e.code)&&a(l+1)}),(n=localStorage.getItem("settings"))?(n=JSON.parse(n),Object.assign(m,n)):C(),k(),v(),t(),f())}(t=n=n||{})[t.Normal=0]="Normal",t[t.Strip=1]="Strip";var n,t,c,i,g,d,r,h,l,E,L,y,s={blacklist:["yaoi","crossdressing"]},x=function(){var e=localStorage.getItem("indexSettings");e?(e=JSON.parse(e),Object.assign(s,e)):p()},m={mode:0,maxWidth:1366,zoomLevel:1},C=function(){localStorage.setItem("settings",JSON.stringify(m))},b=function(e,t){e in m&&("zoomLevel"!==e||!(t<.1||5<t))&&(m[e]=t,C())},u=[],S=3,w={current:!1},k=function(){0<m.maxWidth?d.style.maxWidth="".concat(m.maxWidth,"px"):d.style.maxWidth="",0<m.zoomLevel?d.style.zoom="".concat(m.zoomLevel):d.style.zoom="";var e=d.firstElementChild;1<m.zoomLevel?e.style.maxWidth="".concat(window.innerWidth*m.zoomLevel,"px"):e.style.maxWidth="",document.querySelectorAll(".zoom-level").forEach(function(e){e.innerText="".concat((100*m.zoomLevel).toFixed(),"%")})},z=function(){var e,t,s,u,n,o,a,c,i,d,r,l;document.getElementById("settings-popup")||((e=document.createElement("div")).id="settings-popup",(t=document.createElement("div")).addEventListener("click",function(){return e.remove()}),t.classList.add("settings-overlay"),(s=document.createElement("div")).classList.add("settings-content"),(u=document.createElement("div")).classList.add("settings-header"),(n=document.createElement("span")).textContent="Settings",u.appendChild(n),(n=document.createElement("div")).classList.add("settings-container"),(o=document.createElement("div")).classList.add("settings-section"),(a=document.createElement("span")).textContent="Zoom",c=document.createElement("div"),(i=document.createElement("button")).type="button",i.textContent="-",i.classList.add("zoom-out"),(l=document.createElement("span")).textContent="".concat((100*m.zoomLevel).toFixed(),"%"),l.classList.add("zoom-level"),(r=document.createElement("button")).type="button",r.textContent="+",r.classList.add("zoom-in"),c.append(i,l,r),o.append(a,c),n.appendChild(o),(o=document.createElement("div")).classList.add("settings-section","max-width"),(a=document.createElement("span")).textContent="Max. width",c=document.createElement("div"),(i=document.createElement("div")).classList.add("wrapper"),(d=document.createElement("input")).type="number",d.min="0",d.defaultValue=m.maxWidth.toString(),d.addEventListener("change",function(){var e=Number(d.value);Number.isNaN(e)&&(d.value="0"),m.maxWidth!==e&&(b("maxWidth",e),k())}),(l=document.createElement("span")).textContent="px",i.append(d,l),c.append(i),o.append(a,c),n.appendChild(o),(r=document.createElement("div")).classList.add("footer"),(l=document.createElement("button")).classList.add("close"),l.type="button",l.textContent="Close",l.addEventListener("click",function(){return e.remove()}),r.appendChild(l),n.appendChild(r),s.append(u,n),e.append(t,s),document.body.appendChild(e),v())},A=function(){document.querySelectorAll("article[data-hidden]").forEach(function(e){return e.removeAttribute("data-hidden")}),s.blacklist&&document.querySelectorAll("article[data-tags]").forEach(function(e){var t=e.dataset.tags.trim().toLowerCase();s.blacklist.some(function(e){return t.includes(e.toLowerCase())})&&(e.dataset.hidden="true")})},q=function(){var e,t,n,o,a,c,i,d,r,l;document.getElementById("settings-popup")||((e=document.createElement("div")).id="settings-popup",(t=document.createElement("div")).addEventListener("click",function(){return e.remove()}),t.classList.add("settings-overlay"),(n=document.createElement("div")).classList.add("settings-content"),(o=document.createElement("div")).classList.add("settings-header"),(a=document.createElement("span")).textContent="Settings",o.appendChild(a),(a=document.createElement("div")).classList.add("settings-container"),(c=document.createElement("div")).classList.add("settings-section","blacklist"),(r=document.createElement("span")).textContent="Hide tags",l=document.createElement("div"),(d=document.createElement("div")).classList.add("wrapper"),(i=document.createElement("input")).type="text",i.defaultValue=s.blacklist.join(", "),i.addEventListener("input",function(){var e,t=i.value.split(",").map(function(e){return e.trim()}).filter(function(e){return e});t=t,(e="blacklist")in s&&(s[e]=t,p()),A()}),d.appendChild(i),l.appendChild(d),c.append(r,l),a.appendChild(c),(d=document.createElement("p")).textContent="Tags are case-insensitive, delimited by commas.",d.style.marginTop="1rem",a.appendChild(d),(r=document.createElement("div")).classList.add("footer"),(l=document.createElement("button")).classList.add("close"),l.type="button",l.textContent="Close",l.addEventListener("click",function(){return e.remove()}),r.appendChild(l),a.appendChild(r),n.append(o,a),e.append(t,n),document.body.appendChild(e))};"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)}();